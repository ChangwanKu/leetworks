---
output:
  html_document: default
  pdf_document: default
  word_document: default
---
------
```{r echo = FALSE}
cprint <- function(contents, type){
  if (type == "h1") {
    cat(sprintf("<h1> %s </h1>", contents))  
  } else if(type == "h2"){
    cat(sprintf("<h2> %s </h2>", contents))  
  } else if(type == "h3"){
    cat(sprintf("<h3> %s </h3>", contents))  
  } else if(type == "h4"){
    cat(sprintf("<h4> %s </h4>", contents))  
  } else if(type == "h5"){
    cat(sprintf("<h5> %s </h5>", contents))  
  } else{
    cat(sprintf("%s", contents))  
  }
}

hr <- function(){
  cat("<hr>")
}
```

```{r comment=NA, error = FALSE, warning=FALSE, message=FALSE, results = "asis", echo=FALSE}


library(dplyr)
library(tidyr)
library(ggplot2)
library(gridExtra)

# 변수 선언 부분

school_name <- c("강원대","서울대")
school_name_print_type <- "h1"
school_index <- 1
year_value <- 2018
subject_print_type <- "h3"

# 본문 시작

cprint(school_name[school_index], school_name_print_type)

hr()

# 모집인원, 기본계획 제목
cprint("모집인원 | 기본계획", subject_print_type)
hr()

# 모집인원 pie chart
raw_data_pie <- read.csv('./rawdatas/abc2.csv')
selected_data_pie <- raw_data_pie %>% filter(schoolindex == school_index & year == year_value)
selected_data_pie <- gather(selected_data_pie,,,-1)
pie <- ggplot(selected_data_pie,aes(x='',y=value,fill=key)) + geom_bar(width = 1, stat = 'identity')
pie <- pie+coord_polar('y',start=0)
blank_theme <- theme_minimal()+
  theme(
    axis.title.x = element_blank(),
    axis.title.y = element_blank(),
    panel.border = element_blank(),
    panel.grid=element_blank(),
    axis.ticks = element_blank(),
    plot.title=element_text(size=14, face="bold")
  )

pie <- pie + scale_fill_grey() + blank_theme +  theme(axis.text.x=element_blank())

# table plot

raw_data_table <- read.csv('./rawdatas/abc.csv')
selected_data_table <- raw_data_table %>% filter(schoolindex == school_index & year == year_value) %>% select(level,leet,gpa,lang,doc,essay,interview,sum)
selected_data_table[is.na(selected_data_table)] <- 0


# pie 랑 table 결합 
grid.arrange(pie,tableGrob(selected_data_table, rows = NULL),nrow=1)


# 남녀 비율

cprint("남녀 비율", subject_print_type)
hr()

raw_data_sex <- read.csv('./rawdatas/sex.csv')

selected_data_sex <- raw_data_sex %>% filter(schoolindex == school_index) %>% select(m14, w14, m15, w15, m16, w16, m17, w17)
selected_data_sex <- gather(selected_data_sex)
selected_data_sex <- selected_data_sex %>% mutate(group=substr(key,1,1),year=substr(key,2,3))
ggplot(selected_data_sex,aes(x=year, y=value, fill = group)) + geom_bar(stat='identity', position = 'dodge')



# 자교 비율

cprint("자교 비율", subject_print_type)
hr()
```
